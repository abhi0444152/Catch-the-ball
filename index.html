<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catch the Ball — Simple Game</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--accent:#06b6d4;--text:#e6eef6}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071025,#07172a);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text)}
    .wrap{width:360px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
    h1{font-size:18px;margin:0 0 8px;text-align:center}
    #game{background:#071323;border-radius:8px;overflow:hidden;position:relative;width:320px;height:480px;margin:0 auto;box-shadow:inset 0 6px 18px rgba(0,0,0,0.6)}
    .paddle{position:absolute;bottom:12px;height:14px;width:80px;background:linear-gradient(90deg,var(--accent),#0891b2);border-radius:8px;left:120px}
    .ball{position:absolute;width:18px;height:18px;border-radius:50%;background:linear-gradient(180deg,#ffd166,#ff6b6b);left:150px;top:60px}
    .hud{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:14px;color:#b8c7d3}
    .controls{display:flex;gap:8px;justify-content:center;margin-top:10px}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:#012027;cursor:pointer}
    .small{font-size:12px;color:#9fb0c1}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);visibility:hidden;opacity:0;transition:opacity .2s}
    .modal.show{visibility:visible;opacity:1}
    .modal .box{background:#071323;padding:16px;border-radius:10px;min-width:260px;text-align:center}
    @media (max-width:420px){.wrap{width:95%}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Catch the Ball</h1>
    <div id="game" tabindex="0" aria-label="Game area">
      <div class="ball" id="ball"></div>
      <div class="paddle" id="paddle"></div>
    </div>
    <div class="hud">
      <div>Score: <strong id="score">0</strong></div>
      <div>Lives: <strong id="lives">3</strong></div>
    </div>
    <div class="controls">
      <button id="start">Start</button>
      <button id="reset">Reset</button>
    </div>
    <p class="small">Use ← → arrows or drag the paddle (touch supported). Catch the falling ball. Difficulty increases with score.</p>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="box">
      <div id="modalText">Game over</div>
      <div style="margin-top:10px"><button id="modalBtn">OK</button></div>
    </div>
  </div>

  <script>
    try{
      const game = document.getElementById('game');
      const paddle = document.getElementById('paddle');
      const ball = document.getElementById('ball');
      const scoreEl = document.getElementById('score');
      const livesEl = document.getElementById('lives');
      const startBtn = document.getElementById('start');
      const resetBtn = document.getElementById('reset');
      const modal = document.getElementById('modal');
      const modalText = document.getElementById('modalText');
      const modalBtn = document.getElementById('modalBtn');

      const G = {width:320, height:480};
      let score = 0, lives = 3;
      let baseSpeedY = 3.0, baseSpeedX = 1.6;
      let ballX = 150, ballY = 60, ballSpeedY = baseSpeedY, ballSpeedX = baseSpeedX;
      let paddleX = 120;
      let animId = null;
      let running = false;

      function render() {
        const pw = parseInt(getComputedStyle(paddle).width,10);
        paddleX = Math.max(4, Math.min(G.width - pw - 4, paddleX));
        paddle.style.left = paddleX + 'px';
        ballX = Math.max(4, Math.min(G.width - 22, ballX));
        // allow ballY slightly above 0 so top bounce can trigger but clamp to safe range
        ballY = Math.max(-8, Math.min(G.height + 40, ballY));
        ball.style.left = ballX + 'px';
        ball.style.top = ballY + 'px';
      }

      function resetBall(){
        ballX = Math.max(10, Math.random()*(G.width-30));
        ballY = 30;
        const speedFactor = 1 + Math.min(3, score * 0.12);
        ballSpeedY = baseSpeedY * speedFactor * 1; // downward when reset
        ballSpeedX = (Math.random()>0.5?1:-1) * baseSpeedX * (0.9 + Math.min(2.0, score * 0.06));
      }

      function showModal(text){
        modalText.textContent = text;
        modal.classList.add('show');
      }
      function hideModal(){ modal.classList.remove('show'); }

      function gameOver(){
        running = false;
        cancelAnimationFrame(animId);
        showModal('Game over! Your score: ' + score);
      }

      function update() {
        if(!running) return;

        // apply movement
        ballX += ballSpeedX;
        ballY += ballSpeedY;

        // left/right walls bounce
        if(ballX <= 4){ ballX = 4; ballSpeedX = Math.abs(ballSpeedX); }
        if(ballX >= G.width - 22){ ballX = G.width - 22; ballSpeedX = -Math.abs(ballSpeedX); }

        // TOP bounce: make it robust — if ball reaches or crosses top, force it downward
        if(ballY <= 2){
          // put it at safe top position and make sure vertical speed is a decent positive number
          ballY = 2;
          // If current speed is already positive, ensure it's not tiny; else make it positive.
          if(Math.abs(ballSpeedY) < 0.8) {
            ballSpeedY = Math.max(1.6, Math.abs(ballSpeedY) + 1.2);
          } else {
            ballSpeedY = Math.abs(ballSpeedY) * 0.95; // dampen slightly but ensure downward
          }
        }

        // check paddle collision (only when ball is moving downward)
        const paddleTop = G.height - 12 - 14;
        const paddleW = parseInt(getComputedStyle(paddle).width,10);
        if(ballY + 18 >= paddleTop && ballSpeedY > 0){
          if(ballX + 9 >= paddleX && ballX <= paddleX + paddleW){
            // caught
            score += 1;
            scoreEl.textContent = score;
            // bounce up with increased speed
            const upwardSpeed = 2.8 + Math.min(8, score * 0.22);
            ballSpeedY = -upwardSpeed;
            // horizontal nudge
            const hitPos = (ballX - paddleX) - (paddleW/2);
            ballSpeedX += hitPos * 0.03;
            // cap horizontal
            const maxHX = 9;
            if(ballSpeedX > maxHX) ballSpeedX = maxHX;
            if(ballSpeedX < -maxHX) ballSpeedX = -maxHX;
          }
        }

        // missed
        if(ballY > G.height){
          lives -= 1;
          livesEl.textContent = lives;
          if(lives <= 0){ gameOver(); return; }
          resetBall();
        }

        render();
        animId = requestAnimationFrame(update);
      }

      // keyboard
      document.addEventListener('keydown', (e)=>{
        if(!running) return;
        if(e.key === 'ArrowLeft') paddleX = Math.max(4, paddleX - 18);
        if(e.key === 'ArrowRight') paddleX = Math.min(G.width - parseInt(getComputedStyle(paddle).width) - 4, paddleX + 18);
        render();
      });

      // touch/mouse drag
      let dragging = false;
      paddle.addEventListener('pointerdown', (e)=>{ dragging=true; paddle.setPointerCapture(e.pointerId); });
      game.addEventListener('pointermove', (e)=>{
        if(!dragging) return;
        const rect = game.getBoundingClientRect();
        let x = e.clientX - rect.left - parseInt(getComputedStyle(paddle).width)/2;
        x = Math.max(4, Math.min(G.width - parseInt(getComputedStyle(paddle).width) - 4, x));
        paddleX = x;
        render();
      });
      window.addEventListener('pointerup', ()=> dragging = false);

      startBtn.addEventListener('click', ()=>{
        if(running) return;
        running = true;
        score = 0; lives = 3; scoreEl.textContent = score; livesEl.textContent = lives;
        resetBall();
        animId = requestAnimationFrame(update);
        game.focus();
      });

      resetBtn.addEventListener('click', ()=>{
        running = false; cancelAnimationFrame(animId); score = 0; lives = 3; scoreEl.textContent = score; livesEl.textContent = lives; paddleX = 120; resetBall(); render(); hideModal();
      });

      modalBtn.addEventListener('click', ()=>{ hideModal(); });

      console.log('Game script loaded.');

      // initial
      resetBall(); render();

    } catch(err){
      console.error('Error initializing game:', err);
      alert('There was an error starting the game. Open developer console to see details.');
    }
  </script>
</body>
</html>
